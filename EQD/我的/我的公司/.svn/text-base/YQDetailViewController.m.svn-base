//
//  YQDetailViewController.m
//  EQD
//
//  Created by 梁新帅 on 2017/5/10.
//  Copyright © 2017年 FitBoy. All rights reserved.
//

#import "YQDetailViewController.h"
#import "RZWanShanViewController.h"
@interface YQDetailViewController ()<UITableViewDataSource,UITableViewDelegate>
{
    UITableView *tableV;
    NSMutableArray *arr_big;
}

@end

@implementation YQDetailViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    self.navigationItem.title = @"入驻邀请";
    arr_big = [NSMutableArray arrayWithCapacity:0];
    NSMutableArray *arr_one = [NSMutableArray arrayWithArray:@[@[@"邀约公司",self.model.icom],@[@"邀约人部门",self.model.isec],@[@"邀约人",self.model.ipeople],@[@"邀约人职务",self.model.ipost],@[@"邀约人的电话",self.model.itel]]];
    NSMutableArray *arr_two = [NSMutableArray arrayWithArray:@[@[@"入驻部门",self.model.iesec],@[@"入驻岗位",self.model.iepost]]];
    NSMutableArray *arr_three = [NSMutableArray arrayWithArray:@[@"接受"]];
    [arr_big addObject:arr_one];
    [arr_big addObject:arr_two];
    [arr_big addObject:arr_three];
    tableV = [[UITableView alloc]initWithFrame:CGRectMake(0, 0, DEVICE_WIDTH, DEVICE_HEIGHT) style:UITableViewStyleGrouped];
    tableV.delegate=self;
    tableV.dataSource=self;
    [self.view addSubview:tableV];
    tableV.rowHeight=50;
}
#pragma  mark - 表的数据源
-(CGFloat)tableView:(UITableView *)tableView heightForHeaderInSection:(NSInteger)section
{
    return 6;
}
-(NSInteger)numberOfSectionsInTableView:(UITableView *)tableView
{
    return arr_big.count;
}
-(NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section
{
    NSArray *arr = arr_big[section];
    return arr.count;
}
-(UITableViewCell*)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath{
    static NSString *cellId=@"cellID";
    UITableViewCell *cell =[tableView dequeueReusableCellWithIdentifier:cellId];
    if (!cell) {
        cell = [[UITableViewCell alloc]initWithStyle:UITableViewCellStyleValue1 reuseIdentifier:cellId];
        cell.accessoryType = UITableViewCellAccessoryNone;
    }
    if(indexPath.section==arr_big.count-1)
    {
        UILabel *tlabel = [[UILabel alloc]initWithFrame:CGRectMake(0, 0, DEVICE_WIDTH, 50)];
        tlabel.text = @"接受邀请";
        tlabel.textColor = [UIColor whiteColor];
        tlabel.textAlignment = NSTextAlignmentCenter;
        [cell addSubview:tlabel];
        cell.backgroundColor = EQDCOLOR;
        cell.selectionStyle = UITableViewCellSelectionStyleNone;
    }
    else
    {
    NSArray *arr = arr_big[indexPath.section];
    NSArray *small_arr = arr[indexPath.row];
    cell.textLabel.text = small_arr[0];
    cell.detailTextLabel.text = small_arr[1];
    }
    return cell;
}

#pragma  mark - 表的协议代理
-(void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath
{
    if (indexPath.section==arr_big.count-1) {
        //接受邀请
        // 判断是否在公司
        [WebRequest Com_SelectStaffWithuid:[USERDEFAULTS objectForKey:Y_Zhanghao] And:^(NSDictionary *dic) {
            NSArray *arr =dic[Y_ITEMS];
            if (arr.count) {
                NSDictionary *dic1 =arr[0];
                MBProgressHUD *hud=[MBProgressHUD showHUDAddedTo:self.view  animated:YES];
                hud.mode = MBProgressHUDModeText;
                hud.label.text =[NSString stringWithFormat:@"您已在%@，不能再加入其它企业",dic1[@"cname"]];
                dispatch_time_t popTime = dispatch_time(DISPATCH_TIME_NOW, 1 * NSEC_PER_SEC);
                dispatch_after(popTime, dispatch_get_main_queue(), ^(void){
                    [MBProgressHUD hideHUDForView:self.view  animated:YES];
                });
            }
            else
            {
                RZWanShanViewController *WSvc =[[RZWanShanViewController alloc]init];
                WSvc.model=self.model;
                [self.navigationController pushViewController:WSvc animated:NO];
                
            }
        }];
        
        
        
    }
}



@end
