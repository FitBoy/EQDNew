//
//  MGongSiViewController.m
//  YiQiDian
//
//  Created by 梁新帅 on 2017/3/16.
//  Copyright © 2017年 FitBoy. All rights reserved.
//

#import "MGongSiViewController.h"
#import "WebRequest.h"
#import "GSRegisterViewController.h"
#import "GSQiYeRenZhengViewController.h"
#import "GSYaoQingViewController.h"
#import "GSRuZhuViewController.h"
@interface MGongSiViewController ()<UITableViewDelegate,UITableViewDataSource>
{
    UITableView *tableV;
    NSMutableArray *arr_gongsi;
    UserModel *user ;
    ComModel *comM;
    NSMutableArray *arr_cominfo;
    NSMutableArray *arr_cominfocontent;
}

@end

@implementation MGongSiViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    user =[WebRequest GetUserInfo];
    if ([user.comid integerValue]!=0) {
       comM= [WebRequest getCompanyInfo];
        arr_cominfo = [NSMutableArray arrayWithArray:@[@"企业名称",@"企业地址",@"企业邮箱",@"企业编码"]];
        arr_cominfocontent = [NSMutableArray arrayWithArray:@[comM.comname,comM.comadres,comM.comemai,comM.comid]];
    }
    
    self.navigationItem.title = @"我的企业";
    arr_gongsi = [NSMutableArray arrayWithArray:@[@"入驻企业",@"注册企业",@"企业认证",@"入驻邀请"]];
    tableV = [[UITableView alloc]initWithFrame:CGRectMake(0, 0, DEVICE_WIDTH, DEVICE_HEIGHT) style:UITableViewStyleGrouped];
    tableV.delegate=self;
    tableV.dataSource=self;
    [self.view addSubview:tableV];
    tableV.rowHeight=50;
    
}

#pragma  mark - 表的数据源
-(CGFloat)tableView:(UITableView *)tableView heightForHeaderInSection:(NSInteger)section
{
    return 25;
}
-(NSString*)tableView:(UITableView *)tableView titleForHeaderInSection:(NSInteger)section
{
    if (section==0) {
        return nil;
    }
    else
    {
        return @"企业信息";
    }
}
-(NSInteger)numberOfSectionsInTableView:(UITableView *)tableView
{
    return 2;
}
-(NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section
{
    if (section==0) {
        return arr_gongsi.count;

    }
    else
    {
        return arr_cominfo.count;
    }
    }
-(UITableViewCell*)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath{
    static NSString *cellId=@"cellID";
    UITableViewCell *cell =[tableView dequeueReusableCellWithIdentifier:cellId];
    if (!cell) {
        cell = [[UITableViewCell alloc]initWithStyle:UITableViewCellStyleSubtitle reuseIdentifier:cellId];
        cell.accessoryType=UITableViewCellAccessoryDisclosureIndicator;
        
    }
    if (indexPath.section==0) {
        cell.textLabel.text = arr_gongsi[indexPath.row];
    }
    else
    {
        cell.accessoryType=UITableViewCellAccessoryNone;
        cell.textLabel.text =arr_cominfo[indexPath.row];
        cell.detailTextLabel.text =arr_cominfocontent[indexPath.row];
    }
    
    return cell;
}

#pragma  mark - 表的协议代理
-(void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath
{
    if (indexPath.section==0) {
    if ([user.authen integerValue]==0) {
        MBProgressHUD *hud=[MBProgressHUD showHUDAddedTo:self.view  animated:YES];
        hud.mode = MBProgressHUDModeText;
        hud.label.text =@"您未实名认证，请先实名认证";
        dispatch_time_t popTime = dispatch_time(DISPATCH_TIME_NOW, 1 * NSEC_PER_SEC);
        dispatch_after(popTime, dispatch_get_main_queue(), ^(void){
            [MBProgressHUD hideHUDForView:self.view  animated:YES];
        });
    }
    else
    {
    switch (indexPath.row) {
        case 0:
        {
           //入驻企业
            GSRuZhuViewController *RZvc =[[GSRuZhuViewController alloc]init];
            [self.navigationController pushViewController:RZvc animated:NO];
        }
            break;
        case 1:
        {
            
            //企业注册
            if ([user.comid integerValue]==0) {
                GSRegisterViewController *Rvc =[[GSRegisterViewController alloc]init];
                Rvc.phonenumber = [USERDEFAULTS objectForKey:Y_Zhanghao];
                [self.navigationController pushViewController:Rvc animated:NO];
            }
            else
            {
                MBProgressHUD *hud=[MBProgressHUD showHUDAddedTo:self.view  animated:YES];
                hud.mode = MBProgressHUDModeText;
                hud.label.text =@"您已经在公司，不能再注册";
                dispatch_time_t popTime = dispatch_time(DISPATCH_TIME_NOW, 1 * NSEC_PER_SEC);
                dispatch_after(popTime, dispatch_get_main_queue(), ^(void){
                    [MBProgressHUD hideHUDForView:self.view  animated:YES];
                });
            }
            
        }
            break;
        case 2:
        {
            //企业认证
            GSQiYeRenZhengViewController *YZvc =[[GSQiYeRenZhengViewController alloc]init];
            [self.navigationController pushViewController:YZvc animated:NO];
            
        }
            break;
        case 3:
        {
            //入驻邀请
            GSYaoQingViewController *YQvc =[[GSYaoQingViewController alloc]init];
            [self.navigationController pushViewController:YQvc animated:NO];
            
            
        }
            break;
        default:
            break;
    }
    }
    }
}



@end
