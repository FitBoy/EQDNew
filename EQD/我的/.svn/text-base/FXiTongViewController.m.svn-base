//
//  FXiTongViewController.m
//  EQD
//
//  Created by 梁新帅 on 2017/4/14.
//  Copyright © 2017年 FitBoy. All rights reserved.
//

#import "FXiTongViewController.h"
#import <RongIMKit/RongIMKit.h>
#import "MyAboutUsViewController.h"
#import "MMConactViewController.h"
#import "EQDLoginViewController.h"
@interface FXiTongViewController ()<UITableViewDelegate,UITableViewDataSource>
{
    UITableView *tableV;
    NSMutableArray *arr_one;
    NSMutableArray *arr_two;
    NSMutableArray *arr_three;
    NSMutableArray *arr_big;
    UISwitch *S_voice;
    UISwitch *S_notification;
}

@end

@implementation FXiTongViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    self.navigationItem.title = @"系统设置";
    arr_one = [NSMutableArray arrayWithArray:@[@"消息提示音",@"通知"]];
    arr_two = [NSMutableArray arrayWithArray:@[@"帮助与反馈",@"关于易企点",@"联系易企点"]];
    arr_three = [NSMutableArray arrayWithArray:@[@"退出登录"]];
    arr_big = [NSMutableArray arrayWithCapacity:0];
    
    [arr_big addObject:arr_one];
    [arr_big addObject:arr_two];
    [arr_big addObject:arr_three];
    tableV = [[UITableView alloc]initWithFrame:CGRectMake(0, 0, DEVICE_WIDTH, DEVICE_HEIGHT) style:UITableViewStyleGrouped];
    tableV.delegate=self;
    tableV.dataSource=self;
    [self.view addSubview:tableV];
    tableV.rowHeight=40;
    S_voice = [[UISwitch alloc]initWithFrame:CGRectMake(DEVICE_WIDTH-70, 5, 70, 30)];
    [S_voice setOn:![RCIM sharedRCIM].disableMessageAlertSound animated:YES];
    [S_voice addTarget:self action:@selector(voiceClick) forControlEvents:UIControlEventValueChanged];
    
    S_notification=[[UISwitch alloc]initWithFrame:CGRectMake(DEVICE_WIDTH-70, 5, 70, 30)];
    [S_notification setOn:![RCIM sharedRCIM].disableMessageNotificaiton animated:YES];
    [S_notification addTarget:self action:@selector(notificationClick) forControlEvents:UIControlEventValueChanged];
    
}
-(void)voiceClick
{
    [RCIM sharedRCIM].disableMessageAlertSound = !S_voice.on;
}
-(void)notificationClick
{
    [RCIM sharedRCIM].disableMessageNotificaiton = !S_notification.on;
}
#pragma  mark - 表的数据源
-(CGFloat)tableView:(UITableView *)tableView heightForHeaderInSection:(NSInteger)section
{
    return 6;
}
-(NSInteger)numberOfSectionsInTableView:(UITableView *)tableView
{
    return arr_big.count;
}
-(NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section
{
    NSArray *arr = arr_big[section];
    return arr.count;
}
-(UITableViewCell*)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath{
    static NSString *cellId=@"cellID";
    UITableViewCell *cell =[tableView dequeueReusableCellWithIdentifier:cellId];
    if (!cell) {
        cell = [[UITableViewCell alloc]initWithStyle:UITableViewCellStyleDefault reuseIdentifier:cellId];
        
    }
    NSArray *arr = arr_big[indexPath.section];
    cell.textLabel.text = arr[indexPath.row];
    if(indexPath.section==0)
    {
        cell.selectionStyle = UITableViewCellSelectionStyleNone;
        cell.accessoryType = UITableViewCellAccessoryNone;
        if (indexPath.row==0) {
            [cell addSubview:S_voice];
        }
        else
        {
            [cell addSubview:S_notification];
        }
    }
    else if(indexPath.section==1)
    {
        cell.accessoryType = UITableViewCellAccessoryDisclosureIndicator;
        
    }
    else
    {
        cell.accessoryType = UITableViewCellAccessoryNone;
        cell.contentView.backgroundColor  =[UIColor redColor];
        cell.textLabel.textAlignment = NSTextAlignmentCenter;
        cell.textLabel.textColor = [UIColor whiteColor];
    }
    return cell;
}

#pragma  mark - 表的协议代理
-(void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath
{
    if (indexPath.section==1) {
        switch (indexPath.row) {
            case 0:
            {//帮助与反馈
                
            }
                break;
            case 1:
            {
                //关于易企点
                MyAboutUsViewController *AUvc =[[MyAboutUsViewController alloc]init];
                [self.navigationController pushViewController:AUvc animated:NO];
            }
                break;
            case 2:
            {
                //联系易企点
                MMConactViewController *MCvc =[[MMConactViewController alloc]init];
                [self.navigationController pushViewController:MCvc animated:NO];
            }
                break;
            default:
                break;
        }
    }
    
    
    if (indexPath.section==2) {
        [USERDEFAULTS removeObjectForKey:Y_Zhanghao];
        [USERDEFAULTS removeObjectForKey:Y_USERINFO];
        [USERDEFAULTS removeObjectForKey:RC_TOKEN];
        [USERDEFAULTS removeObjectForKey:Y_loginSuccess];
        [USERDEFAULTS removeObjectForKey:Y_MIMA];
        [USERDEFAULTS synchronize];
        [[RCIM sharedRCIM] logout];
        EQDLoginViewController *login =[[EQDLoginViewController alloc]init];
        UINavigationController *nav = [[UINavigationController alloc]initWithRootViewController:login];
        self.view.window.rootViewController =nav;
    }
}



@end
